<?php	include_once(dirname(__FILE__)."/class.sing.php");class Login {	private $xml;	private $ids;	private $install = true;	private $utilisateur;	private $identifiant;	private $privilege;	private $motdepasse;	public function __construct( $lUtilisateur = "" ) {		$this->utilisateur = $lUtilisateur;		$config = new Sing('cfg');		$this->xml = new DOMDocument('1.0', 'utf-8');		if(file_exists(dirname(dirname(__FILE__)).'/xml/ids.xml'))		{			$this->xml->load(dirname(dirname(__FILE__)).'/xml/ids.xml');		} else {			$file = fopen(dirname(dirname(__FILE__)).'/xml/ids.xml', "w");			$txt = "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<ids/>\n";			fwrite($file, $txt);			$this->xml->load(dirname(dirname(__FILE__)).'/xml/ids.xml');		}		if($this->xml->childNodes->length != 0)		{			$this->ids = $this->xml->childNodes->item(0);		}		if( $this->ids->childNodes->length != 0)		{			$this->install=false;			if($lUtilisateur != "" && $this->ids->getElementsByTagName($this->utilisateur)->length != 0)			{				$utilisateur = $this->ids->getElementsByTagName($this->utilisateur)->item(0);				$motdepasse = $utilisateur->getElementsByTagName('motdepasse')->item(0);				$this->motdepasse = $motdepasse->nodeValue;				$privilege = $utilisateur->getElementsByTagName('privilege')->item(0);				$this->privilege = $privilege->nodeValue;			}		}	}	public function setMdp($lMdp)	{		$this->motdepasse = md5($lMdp);		$this->xml->childNodes->item(0)->getElementsByTagName($this->utilisateur)->item(0)->getElementsByTagName('motdepasse')->item(0)->nodeValue = $this->motdepasse;	}	public function loginForm($php_self,$class)	{		$html='';		if(!$this->install)		{			$html.='			<form method="post" action="'.$php_self.'" name="login" id="loginform">				<label for="utilisateur">Utilisateur</label><input class="'.$class.'" type="text" name="utilisateur" id="utilisateur" /><br />				<label for="motdepasse">Mot de passe</label><input class="'.$class.'" type="password" name="motdepasse" id="motdepasse" /><br />				<input type="submit" name="connexion" id="connexion" value="Connexion" />			</form>';		} else {			$html.='			<form method="post" action="'.$php_self.'" name="login" id="loginform">				<label for="administrator">Admin</label><input class="'.$class.'" type="text" name="administrator" id="administrator" /><br />				<label for="password">Mot de passe</label><input class="'.$class.'" type="password" name="password" id="password" /><br />				<!--label for="motdepasse">Mot de passe</label><input class="'.$class.'" type="password" name="motdepasse" id="motdepasse" /><br /-->				<input type="submit" name="admin" id="admin" value="Admin" />			</form>';		}		return $html;	}	public function createAdmin($admin,$password)	{		$ids = $this->xml->createElement('ids');		$adm = $this->xml->createElement($admin);		$mdp = $this->xml->createElement( 'motdepasse', md5($password));		$niv = $this->xml->createElement( 'privilege', 0);		$adm->appendChild($mdp);		$adm->appendChild($niv);		$ids->appendChild($adm);		$this->ids->appendChild($adm);		$this->xml->saveXML();		$this->enregistrer();	}	public function confirmer ($lMdp) {		if(md5($lMdp)==$this->motdepasse)			return true;		return false;	}	public function supprimer () {	}	public function getPrivilege() {		return $this->privilege;	}	public function enregistrer () {		$config = new Sing('cfg');		if(file_exists(dirname(dirname(__FILE__)).'/xml/ids.xml'))			unlink(dirname(dirname(__FILE__)).'/xml/ids.xml');		$this->xml->save(dirname(dirname(__FILE__)).'/xml/ids.xml');	}}?>